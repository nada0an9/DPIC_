
@{
    ViewBag.Title = "Dashboard";
}



@model WebApplication27.Models.GroupedUserCountViewModel

<div style="margin-top:6rem">

    @if (ViewBag.Option == "Cases Overview")
    {

        <div class="card" id="DepChart1">
            <div class="card-header">
                Cases Overview
            </div>
            <div class="card-body">
                <div id="template">
                    <label> Pregnancy-Related Cases:</label> @ViewBag.Pregnancy
                    <br />
                    <label> Average Time Per Urgent Cases (Minutes):</label> @ViewBag.m
                    <br />
                    <label> Average Time Per Regular Cases (Hours) :</label> @ViewBag.h
                    <br />
                    <br />
                    <table class="table" style="width: 50%;">
                        <thead>
                            <tr>
                                <td>Employee Full Name </td>
                                <td>Cases</td>
                            </tr>
                        </thead>


                        @foreach (var item in Model.Items)
                        {

                            <tr>
                                <td>

                                    @Html.DisplayFor(modelItem => item.Name)
                                </td>
                                <td>

                                    @Html.DisplayFor(modelItem => item.Count)
                                </td>


                            </tr>



                        }

                    </table>

                </div>




            </div>
        </div>
    }

    else if (ViewBag.Option == "Type of Requester")
    {<div class="card" id="DepChart1">
            <div class="card-header">
                Type of Requester
            </div>
            <div class="card-body">
                <div id="reportPage">

                    <br /><br /><br />

                    <div style="width: 50%; height: 260px; clear: both;">
                        <canvas id="departmentChart" style="width: 40%"></canvas>
                    </div>
                </div>
                <hr />
                <a href="#" id="downloadPdf">Download as PDF</a>
            </div>
        </div>}
    else if (ViewBag.Option == "References")
    { <div class="card" id="refChart1">
            <div class="card-header">
                References
            </div>
            <div class="card-body">
                <div id="reportPage">

                    <br /><br /><br />

                    <div style="width: 50%; height: 260px; clear: both;">
                        <canvas id="referencesChart" style="width: 40%"></canvas>
                    </div>
                </div>
                <hr />
                <a href="#" id="downloadPdf">Download as PDF</a>


            </div>
        </div>
    }
    else if (ViewBag.Option == "General Question Categories")
    {<div class="card" id="catChart">
            <div class="card-header">
                General Question Categories
            </div>
            <div class="card-body">
                <div class="card-body">
                    <div id="reportPage">

                        <br /><br /><br />

                        <div style="width: 50%; height: 260px; clear: both;">
                            <canvas id="categoriesChart" style="width: 40%"></canvas>
                        </div>
                    </div>
                    <hr />
                    <a href="#" id="downloadPdf">Download as PDF</a>


                </div>



            </div>
        </div>}
    else if (ViewBag.Option == "Patient Specific Categories")
    {<div class="card" id="speCatChart">
            <div class="card-header">
                Patient Specific Categories
            </div>
            <div class="card-body">
                <div id="reportPage">

                    <br /><br /><br />

                    <div style="width: 50%; height: 260px; clear: both;">
                        <canvas id="specificCategoriesChart" style="width: 40%"></canvas>
                    </div>
                </div>
                <hr />
                <a href="#" id="downloadPdf">Download as PDF</a>


            </div>
        </div>}
    else if (ViewBag.Option == "Inquery Sourse")
    {

        <div class="card" id="inquiryChart">
            <div class="card-header">
                Inquiry Source
            </div>
            <div class="card-body">
                <div id="reportPage">

                    <br /><br /><br />

                    <div style="width: 50%; height: 260px; clear: both;">
                        <canvas id="InquirysourceChart" style="width: 40%"></canvas>
                    </div>
                </div>
                <hr />
                <a href="#" id="downloadPdf">Download as PDF</a>




            </div>
        </div>}
    else if (ViewBag.Option == "Was the Ultimate Question Different from Original Question")
    {<div class="card" id="differPieChart">
            <div class="card-header">
                Was the Ultimate Question Different from Original Question?
            </div>
            <div class="card-body">
                <div id="reportPage">

                    <br /><br /><br />

                    <div style="width: 50%; height: 260px; clear: both;">
                        <canvas id="IsDifferChart" style="width: 40%"></canvas>
                    </div>
                </div>
                <hr />
                <a href="#" id="downloadPdf">Download as PDF</a>




            </div>


        </div> }
    else if (ViewBag.Option == "Ultimate Categories")
    {<div class="card" id="ultimateChart">
            <div class="card-header">
                Ultimate Categories
            </div>
            <div class="card-body">
                <div id="reportPage">

                    <br /><br /><br />

                    <div style="width: 50%; height: 260px; clear: both;">
                        <canvas id="ultimateCategoryChart" style="width: 40%"></canvas>
                    </div>
                </div>
                <hr />
                <a href="#" id="downloadPdf">Download as PDF</a>




            </div>
        </div>
    }
    else if (ViewBag.Option == "All Charts")
    {<div class="card" id="ultimateChart">
            <div class="card-header">
                All Charts
            </div>
            <div class="card-body">

                <div id="reportPage" style="text-align:center">

                    <br /><br /><br />

                    <div style="width: 30%; height: 150px; clear: both; float:left">
                        <canvas id="ultimateCategoryChart" style="width: 40%"></canvas>
                    </div>
                    <div style="width: 30%; height: 200px;  float:right">
                        <canvas id="IsDifferChart" style="width: 60%"></canvas>
                    </div>
                    <div style="width: 30%; height: 200px; clear: both; float:left">
                        <canvas id="InquirysourceChart" style="width: 40%"></canvas>
                    </div>
                    <div style="width: 30%; height: 150px;  float:right">
                        <canvas id="specificCategoriesChart" style="width: 40%"></canvas>
                    </div>
                    <div style="width: 30%; height: 150px; clear: both; float:left">
                        <canvas id="categoriesChart" style="width: 40%"></canvas>
                    </div>
                    <div style="width: 30%; height: 150px; float:right">
                        <canvas id="referencesChart" style="width: 40%"></canvas>
                    </div>
                    <div style="width: 30%; height: 150px; clear: both;">
                        <canvas id="departmentChart" style="width: 40%"></canvas>
                    </div>
                </div>
                <hr />
                <a href="#" id="downloadPdf">Download as PDF</a>




            </div>
        </div>
    }

</div>
    <script type="text/javascript">
            $(document).ready(function () {

            var repArray = @Html.Raw(Json.Encode(ViewBag.rep));
            var Depatment = @Html.Raw(Json.Encode(ViewBag.depName));
            var ctx = $("#departmentChart");
            var Barchat1 = new Chart(ctx, {

                type: 'bar',
                data: {

                    labels: Depatment,
                    datasets: [{
                        label: "Departments",
                        data: repArray,
                        backgroundColor: ["rgba(242,166,54,.5)", "rgba(154,65,72,.5)", "(74,25,92,.5)"],
                        borderColor: ["rgb(242,166,54)", "rgb(154,65,72)", "rgb(74,25,92)"],
                        borderWidth: 1




                    }]

                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        xAxes: [{
                            display: true

                        }],
                        yAxes: [{
                            display: false,
                            ticks: {
                                min: 0
                            }                    }],
                    },
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'Departments'
                    }

                },
            });






            });
            $(document).ready(function ()  {


            var rep_2_Array = @Html.Raw(Json.Encode(ViewBag.rep_2));
            var refrenses = @Html.Raw(Json.Encode(ViewBag.refrensesName));
            var ctx_2 = $("#referencesChart");
            var Barchat2= new Chart(ctx_2, {

                type: 'bar',
                data: {

                    labels: refrenses,
                    datasets: [{
                        label: "References",
                        data: rep_2_Array,
                        backgroundColor: ["rgba(242,166,54,.5)", "rgba(154,65,72,.5)", "(74,25,92,.5)"],
                        borderColor: ["rgb(242,166,54)", "rgb(154,65,72)", "rgb(74,25,92)"],
                        borderWidth: 1




                    }]

                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        xAxes: [{
                            display: true

                        }],
                        yAxes: [{
                            display: false,
                            ticks: {
                                min: 0
                            }                    }],
                    },
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'References'
                    },

                },
            });






              });
            $(document).ready(function () {


            var rep_3_Array = @Html.Raw(Json.Encode(ViewBag.rep_3));
            var categories = @Html.Raw(Json.Encode(ViewBag.categoriesName));
            var ctx_3 = $("#categoriesChart");
            var Barchat3 = new Chart(ctx_3, {

                type: 'bar',
                data: {

                    labels: categories,
                    datasets: [{
                        label: "General Categories",
                        data: rep_3_Array,
                        backgroundColor: ["rgba(242,166,54,.5)", "rgba(154,65,72,.5)", "(74,25,92,.5)"],
                        borderColor: ["rgb(242,166,54)", "rgb(154,65,72)", "rgb(74,25,92)"],
                        borderWidth: 1




                    }]

                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        xAxes: [{
                            display: true

                        }],
                        yAxes: [{
                            display: false,
                            ticks: {
                                min: 0
                            }                    }],
                    },
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'General Categories'
                    },

                },
            });






            });
            $(document).ready(function () {


            var rep_4_Array = @Html.Raw(Json.Encode(ViewBag.rep_4));
          var specificCategories = @Html.Raw(Json.Encode(ViewBag.specificCategoriesName));
                                  var ctx_4 = $("#specificCategoriesChart");
            var Barchat4 = new Chart(ctx_4, {

                type: 'bar',
                data: {

                    labels: specificCategories,
                    datasets: [{
                        label: "Specific Categories",
                        data: rep_4_Array,
                        backgroundColor: ["rgba(242,166,54,.5)", "rgba(154,65,72,.5)", "(74,25,92,.5)"],
                        borderColor: ["rgb(242,166,54)", "rgb(154,65,72)", "rgb(74,25,92)"],
                        borderWidth: 1




                    }]

                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        xAxes: [{
                            display: true

                        }],
                        yAxes: [{
                            display: false,
                            ticks: {
                                min: 0
                            }                    }],
                    },
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'Specific Categories'
                    },

                },
            });






            });
            $(document).ready(function () {


            var rep_5_Array = @Html.Raw(Json.Encode(ViewBag.rep_5));
            var Inquirysource = @Html.Raw(Json.Encode(ViewBag.Inquirysource));
           var ctx_5 = $("#InquirysourceChart");
            var Barchat5 = new Chart(ctx_5, {

                type: 'pie',
                data: {

                    labels: Inquirysource,
                    datasets: [{
                        label: "Inquiry Source",
                        data: rep_5_Array,
                        backgroundColor: ["rgba(242,166,54,.5)", "rgba(154,65,72,.5)", "(74,25,92,.5)"]




                    }]

                },
                options: {
                    title: {
                        display: true,
                        text: 'Inquiry Source'
                    },
                },


            });






                                      });
            $(document).ready(function () {

            var rep_6_Array = @Html.Raw(Json.Encode(ViewBag.rep_6));
                var IsDiffer = @Html.Raw(Json.Encode(ViewBag.IsDiffer));
                var ctx_6 = $("#IsDifferChart");
            var Barchat6 = new Chart(ctx_6, {

                type: 'pie',
                data: {

                    labels: IsDiffer,
                    datasets: [{
                        label: "Was the Ultimate Question Different from Original Question",
                        data: rep_6_Array,
                        backgroundColor: ["rgba(242,166,54,.5)", "rgba(154,65,72,.5)", "(74,25,92,.5)"],




                    }]

                },
                options: {
                    title: {
                        display: true,
                        text: 'Was the Ultimate Question Different from Original Question?'
                    },
                },


            });






            });
            $(document).ready(function () {


            var rep_7_Array = @Html.Raw(Json.Encode(ViewBag.rep_7));
            var ultimateCategory = @Html.Raw(Json.Encode(ViewBag.ultimateCategory));
             var ctx_7 = $("#ultimateCategoryChart");
            var Barchat7 = new Chart(ctx_7, {

                type: 'bar',
                data: {

                    labels: ultimateCategory,
                    datasets: [{
                        label: "Ultimate Categories",
                        data: rep_7_Array,
                        backgroundColor: ["rgba(242,166,54,.5)", "rgba(154,65,72,.5)", "(74,25,92,.5)"],
                        borderColor: ["rgb(242,166,54)", "rgb(154,65,72)", "rgb(74,25,92)"],
                        borderWidth: 1




                    }]

                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        xAxes: [{
                            display: true

                        }],
                        yAxes: [{
                            display: false,
                            ticks: {
                                min: 0
                            }                    }],
                    },
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'Ultimate Categories'
                    },

                },
            });






                      });



        $('#downloadPdf').click(function (event) {
            // get size of report page
            var reportPageHeight = $('#reportPage').innerHeight();
            var reportPageWidth = $('#reportPage').innerWidth();

            // create a new canvas object that we will populate with all other canvas objects
            var pdfCanvas = $('<canvas />').attr({
                id: "canvaspdf",
                width: reportPageWidth,
                height: reportPageHeight
            });

            // keep track canvas position
            var pdfctx = $(pdfCanvas)[0].getContext('2d');
            var pdfctxX = 0;
            var pdfctxY = 0;
            var buffer = 100;

            // for each chart.js chart
            $("canvas").each(function (index) {
                // get the chart height/width
                var canvasHeight = $(this).innerHeight();
                var canvasWidth = $(this).innerWidth();

                // draw the chart into the new canvas
                pdfctx.drawImage($(this)[0], pdfctxX, pdfctxY, canvasWidth, canvasHeight);
                pdfctxX += canvasWidth + buffer;

                // our report page is in a grid pattern so replicate that in the new canvas
                if (index % 2 === 1) {
                    pdfctxX = 0;
                    pdfctxY += canvasHeight + buffer;
                }
            });

            // create new pdf and add our new canvas as an image
            var pdf = new jsPDF('t', 'pt', 'a4');
            pdf.setFont("helvetica");
            pdf.setFontType("bold");
            pdf.setFontSize(9);
            pdf.text(20, 20, 'Drugs and Poisons Information Center System');
            pdf.text(20, 40, 'Clinical Pharmacy Department');
            pdf.text(20, 60, 'Pharmaceutical Care Services');
            pdf.text(20, 80, 'Prince Mohamed bin Abdulaziz Hospital- Madinah');



            pdf.addImage($(pdfCanvas)[0], 'PNG',30, 200);

            // download the pdf
            pdf.save('DPIC_Chart.pdf');
        });






    </script>
